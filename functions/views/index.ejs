<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Online Pomodoro Timer - eTomato note, stats and music </title>
  <meta name="description"
    content="eTomato is an online pomodoro timer integrated with notepad and lofi music - providing an efficient vibe to boost your study and work. See your study stats and evaluate your time spent. Check out fellowâ€™s notes and inspire each other.">
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.css" />
  <link type="text/css" rel="stylesheet" href="./public/css/main.css" />
  <link rel="shortcut icon" href="./public/image/tomato.png" type="image/x-icon">
  <!-- Custom stylesheet -->
  <script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>
  <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js'></script>
  <script src="https://www.gstatic.com/firebasejs/ui/6.0.1/firebase-ui-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
</head>

<body onload="onLoad();" style="min-height: 100vh;">
  <div>
    <img src="./public/image/landing_page.png" width="100%" height="100%" alt="">
    <input type="image" src="./public/image/google_login.png" width="315px" height="60px" id="ggLogin1"
      onclick="login()" />
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBe7BVBWqB6znKy7b_UND2nUd09nnUFmEQ",
      authDomain: "etomato-63aac.firebaseapp.com",
      databaseURL: "https://etomato-63aac-default-rtdb.firebaseio.com",
      projectId: "etomato-63aac",
      storageBucket: "etomato-63aac.appspot.com",
      messagingSenderId: "144378496941",
      appId: "1:144378496941:web:dc08de13472e73f14d0324",
      measurementId: "G-7W4Q6GF7JP"
    };
    try {
      firebase.initializeApp(firebaseConfig);
    } catch {}
  </script>
  <script>
    function onLoad() {
      firebase.analytics().logEvent('onLoad');
    }

    function login() {
      firebase.analytics().logEvent('login');
      var provider = new firebase.auth.GoogleAuthProvider();
      firebase.auth()
        .signInWithPopup(provider)
        .then((result) => {
          /** @type {firebase.auth.OAuthCredential} */
          var credential = result.credential;
          // This gives you a Google Access Token. You can use it to access the Google API.
          var token = credential.accessToken;
          // The signed-in user info.
          var user = result.user;
          var photoURL = user.photoURL;
          var displayName = user.displayName;
          var uid = user.uid;
          var email = user.email;
          var phoneNum = user.phoneNum;
          var headers = new Headers();
          headers.append('Content-Type', 'application/json');
          headers.append('Accept', 'application/json')
          firebase.auth().currentUser.getIdToken()
            .then((idToken) => {
              return fetch("./sessionLogin", {
                  method: "POST",
                  mode: 'same-origin',
                  redirect: 'follow',
                  credentials: 'include', // Don't forget to specify this if you need cookies
                  header: headers,
                  body: JSON.stringify({
                    idToken,
                    photoURL,
                    displayName,
                    uid,
                    email,
                    phoneNum
                  }),
                })
                .then(function () {
                  return firebase.auth().signOut();
                })
                .then(function () {
                  window.location.href = "./";
                });
            })
            .catch((error) => {
              alert(error)
            });
        })
        .catch((error) => {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
          // ...
        });
    }
  </script>
</body>

</html>